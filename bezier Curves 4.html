<html>
<head>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
    <script src="Canvas.js"></script>
    <script>
        let curve;
        let pnts = [];
        function setUp() {
            createCanvas(1350, 650, color(255));
            pnts[0] = new Point(
                createVector(200, 200),
                createVector(100, 100),
                createVector(300, 300)
            );
            pnts[1] = new Point(
                createVector(200, 200),
                createVector(100, 100),
                createVector(300, 300)
            );
        }
        function draw() {
            clear();
            pnts[0].update();
            pnts[0].draw();
            for (var i = 0; i < pnts.length; i++) {
                pnts[i].update();
                pnts[i].draw();
            }
        }
        function BezierCurve(times) {
            //var ths = this;
            this.gizmos = [];
            for (var i = 0; i < times; i++) {
                this.gizmos.push(new Gizmo(new Vector2(CanvasWidth / 2, CanvasHeight / 2), color(0, 255, 0)));
            }
            this.points = [];
            this.t = 0;
            this.inc = 0.01;
            this.update = function () {
                let positions = [];
                for (var i = 0; i < this.gizmos.length; i++) {
                    positions.push(this.gizmos[i].position);
                }
                stroke(0);
                lineWidth(2);
                fill(0);
                for (var i = 1; i < positions.length; i++) {
                    ln(positions[i], positions[i - 1]);
                    //console.log(i);
                }
                for (var t = 0; t <= 1; t += this.inc) {
                    let poss = [];
                    for (var i = 0; i < positions.length; i++) {
                        poss.push(positions[i].copy());
                    }
                    let iss = poss.length;
                    for (var i = 0; i < iss; i++) {
                        for (var j = 0; j < poss.length - 1; j++) {
                            if (j + 1 < poss.length) {
                                poss[j] = Vector.lerp(poss[j], poss[j + 1], t);
                            }
                            //poss.pop();
                        }
                        //ln(poss[0], poss[1]);
                    }
                    stroke(0);
                    lineWidth(2);
                    pt(poss[0]);
                }
            }
        }
        function Point(anchor, a, b, isEnd = false) {
            this.draw = function () {
                for (let i in this.cons) {
                    ln(this.pos, this.cons[i]);
                }
            }
            this.flipNo = (no) => this.cons.length - no - 1;
            var ths = this;
            this.isEnd = isEnd;
            this.pos = anchor;
            this.cons = [];
            (a) ? this.cons.push(a): 0;
            (b) ? this.cons.push(b) : 0;
            this.consGs = [];
            for (let i in this.cons) {
                let a = this.cons[i];
                let gz = new Gizmos(a, color(255, 0, 0))
                this.consGs.push(gz);
                if (this.cons.length > 1) {
                    let j = this.flipNo(i);
                    gz.setPos = function (pos) {
                        ths.consGs[j].position = Vector.setRotation(ths.posGizmo.position, ths.consGs[j].position, Vector.Direction(ths.posGizmo.position, pos) + 180);
                        gz.position = pos;

                    }
                }
            }
            this.posGizmo = new Gizmos(anchor, color(255, 0, 0));
            this.setPosition = function (pos) {
                for (let i in this.cons) {
                    let a = this.consGs[i];
                    let offset = Vector.sub(a.position, this.pos);
                    a.position = Vector.add(pos, offset);
                }
                this.posGizmo.position = pos;
            }
            this.posGizmo.setPos = function (pos) { ths.setPosition(pos); };
            this.update = function () {
                for (let i in this.cons) {
                    let aG = this.consGs[i];
                    this.cons[i] = aG.position;
                }
                this.pos = this.posGizmo.position;
            }
        }
        function ln(A, B) {
            line(A.x, A.y, B.x, B.y);
        }
        function pt(P) {
            circle(P.x, P.y, 5);
        }
    </script>

</body>
</html>
