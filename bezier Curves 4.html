
<html>
<head>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
    <script src="Canvas.js"></script>
    <script>
        var curve;
        Gizmo.DEFAULTRADIUS = 8.5;
        function setUp() {
            //console.log("ok");
            createCanvas();
            //frameRate(30);
            curve = new Spline(100, 300, 300, 300, 100, 100, 300, 100);
            curve.add(500, 100, 500, 300);
            curve.add(500, 100, 500, 300);
            curve.add(500, 100, 500, 300);
        }
        function draw() {
            clear();
            curve.draw();
        }
        function bound() {
            console.log(this);
        }
        let slider = new Slider(50, 300, 50, 100, 0, 100, 50);
        function bCurve(a, b, pa, pb) {
            let lp = a;
            lineWidth(3);
            stroke(150, 100);
            ln(pa, a);
            ln(pb, b);
            let val = slider.value;
            saveLineState();
            stroke(0);
            lineWidth(2);
            //console.log(val);
            for (var t = 0; t <= 1; t += 1 / val) {
                let c = Vector.lerp(a, pa, t);
                let d = Vector.lerp(pa, pb, t);
                let e = Vector.lerp(pb, b, t);

                let f = Vector.lerp(c, d, t);
                let g = Vector.lerp(d, e, t);

                let h = Vector.lerp(f, g, t);

                ln(lp, h);
                lp = h;
            }
            ln(lp, b);
            loadLineState();
        }
        class Spline {
            constructor(ax, ay, bx, by, pax, pay, pbx, pby) {
                this.a = new Gizmo(ax, ay);
                //this.a.pair("fart");
                this.pa = new Gizmo(pax, pay);
                this.pa.setParent(this.a);


                this.b = new Gizmo(bx, by);
                this.pb = new Gizmo(pbx, pby);
                this.pb.setParent(this.b);


                this.spline = [];
            }
            add(bx, by, bcx, bcy) {
                this.spline.push(new Curve(this.spline[this.spline.length - 1] ?? this, bx, by, bcx, bcy));
            }
            draw() {
                bCurve(this.a.position, this.b.position, this.pa.position, this.pb.position);
                for (var curve of this.spline) {
                    curve.draw();
                }
            }
        }
        class Curve {
            constructor(previous, bx, by, bcx, bcy) { // ac = a control, bc = b control, previuos = previous curve piece, b = position of point
                this.previous = previous;
                this.a = previous.b;
                this.b = new Gizmo(bx, by);
                let x = 2 * previous.b.x - previous.pb.x;
                let y = 2 * previous.b.y - previous.pb.y;
                this.pa = new Gizmo(x, y);
                this.pa.setParent(this.a);
                this.pb = new Gizmo(bcx, bcy);
                this.pb.setParent(this.b);
                //console.log(previous.b, this.pa);
                previous.pb.pair(this.pa, "move", (dt, a, b) => {
                    //console.log(dt);
                    b.position = Vector.sub(b.parentPosition.copy().mult(2), a.position.copy());
                });
            }
            draw() {
                bCurve(this.a.position, this.b.position, this.pa.position, this.pb.position);
            }
        }
        function ln(A, B) {
            line(A.x, A.y, B.x, B.y);
        }
        function pt(P) {
            circle(P.x, P.y, 5);
        }
    </script>

</body>
</html>
