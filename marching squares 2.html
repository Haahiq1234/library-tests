<!DOCTYPE html>
<html>
    <head>
        <style>

        </style>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <script src="Canvas.js"></script>
        <script src="noise.js"></script>
        <script>
            let cols = 80;
            let rows = 80;
            let grid = new Array2D(cols, rows);
            let smoothness = 8;
            let ga = new Gizmo2(100, 100, color(0, 255, 0));
            ga.setSelectedColor(color(255, 0, 0));
            let gb = new Gizmo2(300, 100, color(0, 255, 0));
            gb.setSelectedColor(color(255, 0, 0));
            let gc = new Gizmo2(300, 300, color(0, 255, 0));
            gc.setSelectedColor(color(255, 0, 0));
            let gd = new Gizmo2(100, 300, color(0, 255, 0));
            gd.setSelectedColor(color(255, 0, 0));
            ga.onClick = logCode;
            gb.onClick = logCode;
            gc.onClick = logCode;
            gd.onClick = logCode;

            ga.setShape(GizmoShapes.rect, 20, 20);
            gb.setShape(GizmoShapes.rect, 20, 20);
            gc.setShape(GizmoShapes.rect, 20, 20);
            gd.setShape(GizmoShapes.rect, 20, 20);
            function setUp() {
                createCanvas(400, 400, color(255));
                frameRate(60);
            }
            function state(bl) {
                return (bl) ? "1": "0";
            }
            function getCode() {
                let a = state(ga.selected);
                let b = state(gb.selected);
                let c = state(gc.selected);
                let d = state(gd.selected);
                return a + b + c + d;
            }
            function logCode() {
                let cd = getCode();
                console.log(cd, base10(cd));
            }
            function marchingSquares(bin, i, j) {
                let cas = base10(bin);
                let a = createVector(CanvasWidth * 1 / 2, CanvasHeight * 1 / 4);
                let b = createVector(CanvasWidth * 3 / 4, CanvasHeight * 1 / 2);
                let c = createVector(CanvasWidth * 1 / 2, CanvasHeight * 3 / 4);
                let d = createVector(CanvasWidth * 1 / 4, CanvasHeight * 1 / 2);
                pt(a);
                pt(b);
                pt(c);
                pt(d);
                let arr = [];
                if (cas != 15) {
                    if (ga.selected) {
                        ln(ga.position, a);
                        ln(ga.position, d);
                        arr.push(d, ga.position, a);
                    }
                    if (gb.selected) {
                        ln(gb.position, a);
                        ln(gb.position, b);
                        arr.push(a, gb.position, b);

                    }
                    if (gc.selected) {
                        ln(gc.position, b);
                        arr.push(b, gc.position, c);
                        ln(gc.position, c);
                    }
                    if (gd.selected) {
                        ln(gd.position, c);
                        ln(gd.position, d);
                        arr.push(c, gd.position, d);
                    }
                }
                noStroke();
                fill(0, 255, 0);
                //lineWidth(2);
                shape.draw(...Vector.array(...arr));

                switch (cas) {
                    case 1:
                        ln(d, c);
                        break;
                    case 2:
                        ln(b, c);
                        break;
                    case 3:
                        ln(b, d);
                        break;
                    case 4:
                        ln(a, b);
                        break;
                    case 5:
                        ln(a, d);
                        ln(b, c);
                        break;
                    case 6:
                        ln(a, c);
                        break;
                    case 7:
                        ln(a, d);
                        break;
                    case 8:
                        ln(a, d);
                        break;
                    case 9:
                        ln(a, c);
                        break;
                    case 10:
                        ln(a, b);
                        ln(c, d);
                        break;
                    case 11:
                        ln(a, b)
                        break;
                    case 12:
                        ln(b, d);
                        break;
                    case 13:
                        ln(b, c);
                        break;
                    case 14:
                        ln(c, d);
                        break;
                    default:
                        break;
                }
            }
            function draw() {                
                clear();
                let cd = getCode();
                marchingSquares(cd);
            }
            function ln(A, B) {
                line(A.x, A.y, B.x, B.y);
            }
            function pt(P) {
                circle(P.x, P.y, 2);
            }
            let baseTables = {
                2: ["0", "1"],
                16: "0123456789abcdef".split(""),
                10: "123456789".split("")
            };
            function base10(num, base = 2) {
                let ans = 0;
                let len = num.length;
                let l = len - 1
                for (var i = 0; i < len; i++) {
                    let i2 = l - i;
                    let i3 = parseInt(num[i]);
                    //console.log(i3);
                    ans += i3 * (base ** i2);
                }
                return ans;
            }
            // first exponential
        </script>
    </body>
</html>