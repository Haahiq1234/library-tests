<html>
<head>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
    <script src="Canvas.js"></script>
    <script>
        var verts = [100, 100, 200, 75, 300, 100, 325, 200, 300, 300, 200, 325, 100, 300, 75, 200];
        let tt = 0;
        let inc = 0.001;
        let slider;
        function setUp() {
            createCanvas(400, 400);
            frameRate(60);
            slider = createSlider(1, 20, 1, 20, "Resolution");
        }
        function draw() {
            clear();
            nofill();

            let vts = Shapes.shape.vertices.rotate(200, 200, tt * 360, verts);
            shape.draw(...vts);

            rect(100, 100, 200, 200)
            tt += inc;
            let vss = Shapes.rect.vertices.rotate(200, 200, tt * 360, 100, 100, 200, 200);

            let pt = Shapes.rect.perimeter.interpolate(tt, 100, 100, 200, 200);
            shape.draw(...vss);
            circle(pt.x, pt.y, 5);
            line(pt.x, pt.y, 200, 200);
            line(pt.x, pt.y, vss[0], vss[1]);

            let pt2 = Shapes.rect.perimeter.interpolate(tt + 0.25, 100, 100, 200, 200);
            circle(pt2.x, pt2.y, 5);
            line(pt2.x, pt2.y, 200, 200);
            line(pt2.x, pt2.y, vss[2], vss[3]);

            pt2 = Shapes.rect.perimeter.interpolate(tt + 0.5, 100, 100, 200, 200);
            circle(pt2.x, pt2.y, 5);
            line(pt2.x, pt2.y, 200, 200);
            line(pt2.x, pt2.y, vss[4], vss[5]);

            pt2 = Shapes.rect.perimeter.interpolate(tt + 0.75, 100, 100, 200, 200);
            circle(pt2.x, pt2.y, 5);
            line(pt2.x, pt2.y, 200, 200);
            line(pt2.x, pt2.y, vss[6], vss[7]);

            pt2 = Shapes.rect.perimeter.interpolate(tt + 0.125, 100, 100, 200, 200);
            circle(pt2.x, pt2.y, 5);
            line(pt2.x, pt2.y, 200, 200);
            line(pt2.x, pt2.y, vts[2], vts[3]);

            pt2 = Shapes.rect.perimeter.interpolate(tt + 0.375, 100, 100, 200, 200);
            circle(pt2.x, pt2.y, 5);
            line(pt2.x, pt2.y, 200, 200);
            line(pt2.x, pt2.y, vts[6], vts[7]);

            pt2 = Shapes.rect.perimeter.interpolate(tt + 0.625, 100, 100, 200, 200);
            circle(pt2.x, pt2.y, 5);
            line(pt2.x, pt2.y, 200, 200);
            line(pt2.x, pt2.y, vts[10], vts[11]);

            pt2 = Shapes.rect.perimeter.interpolate(tt + 0.875, 100, 100, 200, 200);
            circle(pt2.x, pt2.y, 5);
            line(pt2.x, pt2.y, 200, 200);
            line(pt2.x, pt2.y, vts[vts.length - 2], vts[vts.length - 1]);


            let vs = Shapes.shape.vertices.points([50, 50, 350, 50, 350, 350, 50, 350], slider.value);
            for (var v of vs) {
                circle(v.x, v.y, 2);
            }

            vs = Shapes.line.vertices.points(100, 200, 300, 200, slider.value);
            for (var v of vs) {
                circle(v.x, v.y, 2);
            }
        }
        const Shapes = {
            line: {
                vertices: {
                    get: function (ax, ay, bx, by) {
                        return [createVector(ax, ay), createVector(bx, by)];
                    },
                    get2: function (a, b) {
                        return [a.x, a.y, b.x, b.y];
                    },
                    points: function (ax, ay, bx, by, res = 1) {
                        let a = createVector(ax, ay);
                        let b = createVector(bx, by);
                        let dist = Vector.dist(a, b);
                        let off = 0;
                        if (dist % res == 0) {
                            off = -1;
                        }
                        let vs = [];
                        res = parseInt(res);
                        for (var i = 0; i < dist + off; i+= res) {
                            vs.push(Vector.interpolate(a, b, i / dist));
                        }
                        vs.push(b.copy());
                        return vs;
                    }
                }
            },
            circle: {
                vertices: {
                    get: function (x, y, r, res = 1) {
                        let times = this.perimeter(r);
                        let o = createVector(x, y);
                        let vs = [];
                        for (var i = 0; i < times; i += res) {
                            let v = Vector.add(o, Vector.AngleToVector(map(i, 0, times, 0, 360)));
                            vs.push(v);
                        }
                        return vs;
                    },
                    get2: function (x, y, r, res = 1) {
                        let vs = this.get(x, y, r, res);
                        let verts = Shapes.shape.vertices.get2(vs);
                        return verts;
                    },
                    rotate: function (ox, oy, ang, x, y, r, res = 1) {
                        let vs = this.get(x, y, r, res);
                        let o = createVector(ox, oy);
                        for (var v of vs) {
                            v.sub(o).rotate(ang).add(o);
                        }
                        return Shapes.shape.vertices.get2(vs);
                    },
                    points: function (x, y, r, res = 1) {
                        return this.get(x, y, r, res);
                    }
                },
                perimeter: {
                    get: function (r) {
                        return 2 * Math.PI * r;
                    },
                    point: function (l, x, y, r, res = 1) {
                        let verts = Shapes.circle.vertices.get2(x, y, r, res);
                        return Shapes.shape.perimeter.point(l, verts);
                    },
                    interpolate: function (t, x, y, r, res = 1) {
                        t *= this.get(r);
                        return this.point(t, x, y, r, res);
                    }
                }
            },
            rect: {
                vertices: {
                    get: function (x, y, w, h) {
                        let vs = [
                            createVector(x, y),
                            createVector(x + w, y),
                            createVector(x + w, y + h),
                            createVector(x, y + h)
                        ];
                        return vs;
                    },
                    get2: function (x, y, w, h) {
                        let vs = this.get(x, y, w, h);
                        let verts = Shapes.shape.vertices.get2(vs);
                        return verts;
                    },
                    rotate: function (ox, oy, ang, x, y, w, h) {
                        let vs = this.get(x, y, w, h);
                        let o = createVector(ox, oy);
                        for (var v of vs) {
                            v.sub(o).rotate(ang).add(o);
                        }
                        return Shapes.shape.vertices.get2(vs);
                    },
                    points: function (x, y, w, h, res = 1) {
                        let verts = this.get(x, y, w, h);
                        let vs = Shapes.shape.vertices.points(verts, res);
                        return vs;
                    }
                },
                perimeter: {
                    get: function (w, h) {
                        return 2 * w + 2 * h;
                    },
                    point: function (l, x, y, w, h) {
                        let verts = Shapes.rect.vertices.get2(x, y, w, h);
                        return Shapes.shape.perimeter.point(l, verts);
                    },
                    interpolate: function (t, x, y, w, h) {
                        t *= this.get(w, h);
                        return this.point(t, x, y, w, h);
                    }
                }
            },
            shape: {
                vertices: {
                    get: function (verts) {
                        let vs = [];
                        for (var i = 0; i < verts.length; i += 2) {
                            vs.push(createVector(verts[i], verts[i + 1]));
                        }
                        return vs;
                    },
                    get2: function (vs) {
                        let verts = [];
                        for (var v of vs) {
                            verts.push(v.x, v.y);
                        }
                        return verts;
                    },
                    rotate: function (ox, oy, ang, verts) {
                        //console.log(ang);
                        let vs = this.get(verts);
                        let o = createVector(ox, oy);
                        for (var v of vs) {
                            v.sub(o).rotate(ang).add(o);
                        }
                        return Shapes.shape.vertices.get2(vs);
                    },
                    setOrigin: function (ox, oy, verts) {
                        let vs = this.get(verts);
                        let o = createVector(ox, oy);
                        for (var v of vs) {
                            v.sub(o);
                        }
                        return vs;
                    },
                    points: function (verts, res = 1) {
                        let per = Shapes.shape.perimeter.get(verts);
                        //console.log(per);
                        res = parseInt(res);
                        let vs = [];
                        for (var i = 0; i < per; i += res) {
                            //console.log(i);
                            vs.push(Shapes.shape.perimeter.point(i, verts));
                        }
                        return vs;
                    }
                },
                perimeter: {
                    get: function (verts) {
                        let ans = 0;
                        let vs = Shapes.shape.vertices.get(verts);
                        for (var i = 0; i < vs.length; i++) {
                            let ai = i;
                            let bi = (i + 1) % vs.length;
                            let dist = Vector.dist(vs[ai], vs[bi]);
                            ans += dist;
                        }
                        return ans;
                    },
                    point: function (t, verts) {
                        let vs = Shapes.shape.vertices.get(verts);
                        let a;
                        let b;
                        let pt;
                        let per = this.get(verts)
                        t = t % per;
                        let v = [];
                        for (var i = 0; i < vs.length; i++) {
                            let ai = i;
                            let bi = (i + 1) % vs.length;
                            let a = vs[ai];
                            let b = vs[bi];
                            let dist = Vector.dist(vs[ai], vs[bi]);
                            if (dist < t) {
                                t -= dist;
                            } else {
                                pt = Vector.interpolate(a, b, t / Vector.dist(a, b));
                                break;
                            }
                        }
                        return pt;
                    },
                    interpolate: function (t, verts) {
                        return this.point(t * this.get(verts), verts);
                    }
                }
            }
        }
    </script>

</body>
</html>
