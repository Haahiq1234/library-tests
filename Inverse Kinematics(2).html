<html>
<head>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <script src="Canvas.js"></script>
    <script>
        var armLength = 300;
        var armSegments = 40;
        let segmentLength = armLength / armSegments;
        const target = new Gizmo(300, 300);
        let arm = [new Vector2(250, 250)];
        function setUp() {
            createCanvas(500, 500);
            frameRate(60);
            for (var i = 1; i <= armSegments; i++) {
                arm.push(new Vector2(arm[0].x + i * segmentLength, arm[0].y));
            }
            lineCap(LINE.ROUND);
            lineWidth(10);
        }
        function draw() {
            IK(arm, target.position);
            clear();
            for (var i = 0; i < arm.length - 1; i++) {
                let a = arm[i];
                let b = arm[i + 1];
                line(a.x, a.y, b.x, b.y);
            }
        }
        function IK(arm, target) {
            for (var i = arm.length - 1 - 1; i >= 0; i--) {
                let p = arm[i];
                let dir = Vector.sub(p, target);
                let dist = Vector.dist(arm[i], arm[i + 1]);
                arm[i + 1] = target.copy();
                target.add(Vector.AngleToVector(dir.heading(), dist));
            }
            let dt = Vector.sub(target, arm[0]);
            for (var i = 1; i < arm.length; i++) {
                arm[i].sub(dt);
            }
            return arm;
        }
    </script>

</body>
</html>
