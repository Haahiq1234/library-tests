<html>
<head>
</head>
<body>
    <script src="Canvas.js"></script>
    <script>
        var FramesPerSecond = 80;
        var balls = [];
        var lines = [];
        class Line {
            constructor(x1, y1, x2, y2) {
                this.a = new Vector2(x1, y1);
                this.b = new Vector2(x2, y2);
            }
            show() {
                stroke(0);
                line(this.a.x, this.a.y, this.b.x, this.b.y);
            }
        }
        var ln;
        let res = 100;
        function setUp() {
            createCanvas(400, 400, "white");
            frameRate(FramesPerSecond);
            for (var i = 0; i < 1; i++) {
                balls.push(new Ball(Random.range(CanvasWidth), Random.range(CanvasHeight), 20, color(255, 0, 0)));
            }
            console.log(balls);
            gravity = new Vector2(0, 0.1);
            ln = new Line(100, 100, 200, 200);
            for (var i = 0; i < 5; i++) {
                let x = Random.rangeInt(CanvasWidth / res + 1) * res;
                let y = Random.rangeInt(CanvasHeight / res + 1) * res;
                let x1 = Random.rangeInt(CanvasWidth / res + 1) * res;
                let y1 = Random.rangeInt(CanvasHeight / res + 1) * res;
                if (x != x1 || y != y1) {
                    lines.push(new Line(x, y, x1, y1));
                }
            }
        }
        function draw() {
            clear();
            for (l of lines) {
                l.show();
            }
            for (var i = 0; i < balls.length; i++) {
                balls[i].run();
            }
            //let coll = distance.line(ln.a.x, ln.a.y, ln.b.x, ln.b.y, mouse.x, mouse.y, 5);
            //line(mouse.x, mouse.y, coll.point.x, coll.point.y);

            ln.show();
        }
        class Ball {
            constructor(x, y, r, col, acc) {
                this.pos = createVector(x, y);
                this.vel = createVector(0, 0);
                this.acc = createVector(0, 0);
                this.r = r;
                this.m = r ** 2;
                this.color = col;
                this.maxSpeed = 8;
                this.maxAcc = 0.1;
            }
            edges() {
                this.pos.x = constraint(this.pos.x, this.r, CanvasWidth - this.r);
                this.pos.y = constraint(this.pos.y, this.r, CanvasHeight - this.r);
            }
            addForce(force) {
                force = force.copy().div(this.m);
                this.acc.add(force);
            }
            collide() {
                for (let ln of lines) {
                    let coll = collision.circleToLine(ln.a.x, ln.a.y, ln.b.x, ln.b.y, this.pos.x, this.pos.y, this.r);
                    if (coll.collided) {
                        this.pos = coll.position;
                        this.vel.limit(3);
                    }
                }
            }
            update() {
                let d = mouse.copy();
                d.sub(this.pos);
                d.limit(this.maxSpeed);
                d.sub(this.vel);
                d.limit(this.maxAcc);
                this.acc.add(d);
                //this.pos = mouse.copy();
                this.vel.add(this.acc);
                this.vel.limit(this.maxSpeed);
                this.pos.add(this.vel);
                this.acc.reset();
            }
            run(i) {
                this.update();
                this.collide();
                this.edges();
                this.draw(i);
            }
            draw(i) {
                fill(this.color);
                circle(this.pos.x, this.pos.y, this.r);
            }
        } // ball 
    </script>
</body>
</html>
