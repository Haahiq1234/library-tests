<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <script src="Canvas.js"></script>
    <script>
        function setUp() {
            createCanvas(400, 400);
            frameRate(60);
            new Box(50, 200, 100, 25);
            new Box(250, 250, 100, 25);
            Player.Init(CanvasWidth / 2 - 30, 0, 60, 100);
        }
        function draw() {
            clear();
            Box.draw();
            Player.update();
        }
        function key_Press() {
            if (keyCode == key.space) {
                Player.jump();
            }
        }
        class Box {
            static boxes = [];
            constructor(x, y, w, h) {
                Box.boxes.push(this);
                this.x = x;
                this.y = y;
                this.w = w;
                this.h = h;
                this.color = color(255, 0, 0);
            }
            static draw() {
                for (var box of Box.boxes) {
                    fill(box.color);
                    rect(box.x, box.y, box.w, box.h);
                }
            }
        }
        var gravity = new Vector2(0, 1);
        class Player {
            static Instance;
            static Init(x, y, w, h) {
                Player.Instance = new Player(x, y, w, h);
            }
            static update() {
                Player.Instance.update();
                Player.Instance.draw();
            }
            constructor(x, y, w, h) {
                this.pos = createVector(x, y);
                this.vel = createVector();
                this.w = w;
                this.h = h;
                this.jumpForce = 20;
            }
            addVel(v) {
                this.vel.add(v);
            }
            update() {
                this.vel.x = GetAxis("horizontal") * 5;
                this.addVel(gravity);
                this.pos.add(this.vel);
                this.edges();
            }
            get y() {
                return this.pos.y;
            }
            get x() {
                return this.pos.x;
            }
            set x(x) {
                this.pos.x = x;
            }
            set y(y) {
                this.pos.y = y;
            }
            draw() {
                nofill(255, 255, 0);
                rect(this.x, this.y, this.w, this.h);
            }
            jump() {
                this.vel.y = -this.jumpForce;
            }
            static jump() {
                Player.Instance.jump();
            }
            edges() {
                if ((this.y + this.h) > CanvasHeight) {
                    this.y = CanvasHeight - this.h;
                    this.vel.reset();
                }
                let b = Box.boxes[0];
                //let coll = collisionRect2(this.x, this.y, this.w, this.h, b.x, b.y, b.w, b.h);
                ////console.log
                //this.pos.add(coll.neg());
                //if (coll.mag() > 0) {
                //    this.vel.reset();
                //}
                collisionRectLineD(this.x, this.y, this.w, this.h, b.x, b.y, b.x + b.w, b.y);
            }
        }
        function collisionRect(ax, ay, aw, ah, bx, by, bw, bh) {
            let inti = Intersection.RTR(ax, ay, aw, ah, bx, by, bw, bh);
            let off = createVector();
            let len = Infinity;
            for (var i = 0; i < inti.length; i++) {
                let p = inti[i];
                let dp = distance.rect(p.x, p.y, bx, by, bw, bh);
                circle(dp.point.x, dp.point.y, 20);
                //console.log(p, dp);
                //circle(dp.x, dp);
                let o = Vector.sub(dp.point, p);
                //console.log();
                if (o.mag() < len) {
                    len = o.mag();
                    off = o;
                }
            }
            return off;
        }
        function collisionRect2(ax, ay, aw, ah, bx, by, bw, bh) {
            let ib = Intersection.ILTR(ax, ay + ah, ax + aw, ay + ah, bx, by, bw, bh);
            let ob = createVector();
            let len = Infinity;
            for (var i = 0; i < ib.length; i++) {
                let p = ib[i];
                let dp = distance.line(bx, by, bx + bw, by, p.x, p.y);
                circle(dp.point.x, dp.point.y, 20)
                let o = Vector.sub(dp.point, p);
                if (dp.dist < len) {
                    len = dp.dist;
                    ob = o;
                }
            }
            return ob;
        }
        function collisionRectLineD(rx, ry, rw, rh, ax, ay, bx, by) {
            let inti = Intersection.LTR(ax, ay, bx, by, rx, ry, rw, rh);
            for (var i = 0; i < inti.length; i++) {
                circle(inti[i].x, inti[i].y, 5);
            }
        }
    </script>    
</body>
</html>
