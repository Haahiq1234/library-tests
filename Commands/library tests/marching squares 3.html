<!DOCTYPE html>
<html>
    <head>
        <style>

        </style>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <script src="Canvas.js"></script>
        <script src="noise.js"></script>
        <script>
            let cols = 80;
            let rows = 80;
            let grid = new Array2D(cols, rows);
            let smoothness = 8;
            let width;
            let height;
            function setUp() {
                createCanvas(400, 400, color(255));
                frameRate(60);
                generateGrid();
            }
            function generateGrid() {
                backGround(0, 122, 255);
                width = CanvasWidth / cols;
                height = CanvasHeight / rows;
                grid = new Array2D(cols + 1, rows + 1);
                for (var i = 0; i <= cols; i++) {
                    for (var j = 0; j <= rows; j++) {
                        let n = noise(i / smoothness, j / smoothness);
                        n = Math.round(n);
                        grid.set(i, j, n);
                    }
                }
                for (var i = 0; i < cols; i++) {
                    for (var j = 0; j < rows; j++) {
                        let a = grid.get(i, j).toString();
                        let b = grid.get(i + 1, j).toString();
                        let c = grid.get(i + 1, j + 1).toString();
                        let d = grid.get(i, j + 1).toString();
                        marchingSquares(a + b + c + d, i, j, grid.get(i, j), grid.get(i + 1, j), grid.get(i + 1, j + 1), grid.get(i, j + 1));
                    }
                }
            }
            function marchingSquares(bin, i, j, ab, bb, cb, db) {
                let cas = base10(bin);
                let arr = [];
                let av = fv(i, j);
                let bv = fv(i + 1, j);
                let cv = fv(i + 1, j + 1);
                let dv = fv(i, j + 1);
                let a = createVector(fx(i) + width * 0.5, fx(j) + width * 0);
                let b = createVector(fx(i) + width * 1, fx(j) + width * 0.5);
                let c = createVector(fx(i) + width * 0.5, fx(j) + width * 1);
                let d = createVector(fx(i) + width * 0, fx(j) + width * 0.5);
                if (ab == 1) {
                    arr.push(d, av, a);
                }
                if (bb == 1) {
                    arr.push(a, bv, b);
                }
                if (cb == 1) {
                    arr.push(b, cv, c);
                }
                if (db == 1) {
                    arr.push(c, dv, d);
                }
                noStroke();
                fill(0, 255, 0);
                shape.draw(...Vector.array(...arr));
                switch (cas) {
                    case 1:
                        ln(d, c);
                        break;
                    case 2:
                        ln(b, c);
                        break;
                    case 3:
                        ln(b, d);
                        break;
                    case 4:
                        ln(a, b);
                        break;
                    case 5:
                        ln(a, d);
                        ln(b, c);
                        break;
                    case 6:
                        ln(a, c);
                        break;
                    case 7:
                        ln(a, d);
                        break;
                    case 8:
                        ln(a, d);
                        break;
                    case 9:
                        ln(a, c);
                        break;
                    case 10:
                        ln(a, b);
                        ln(c, d);
                        break;
                    case 11:
                        ln(a, b)
                        break;
                    case 12:
                        ln(b, d);
                        break;
                    case 13:
                        ln(b, c);
                        break;
                    case 14:
                        ln(c, d);
                        break;
                    default:
                        break;
                }
            }
            let fx = (i) => i * width;
            let fy = (i) => i * width;
            let fv = (i, j) => createVector(i * width, j * width);
            function draw() {
                //clear();
            }
            function ln(A, B) {
                line(A.x, A.y, B.x, B.y);
            }
            function pt(P) {
                circle(P.x, P.y, 2);
            }
            let baseTables = {
                2: ["0", "1"],
            };
            function base10(num, base = 2) {
                let ans = 0;
                let len = num.length;
                let l = len - 1
                for (var i = 0; i < len; i++) {
                    let i2 = l - i;
                    let i3 = parseInt(num[i]);
                    //console.log(i3);
                    ans += i3 * (base ** i2);
                }
                return ans;
            }
            // first exponential
        </script>
    </body>
</html>